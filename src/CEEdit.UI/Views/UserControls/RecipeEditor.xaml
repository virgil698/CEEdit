<UserControl x:Class="CEEdit.UI.Views.UserControls.RecipeEditor"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="900">
    
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/CEEdit;component/src/CEEdit.UI/Themes/ModernTheme.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>
    
    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
        <StackPanel Margin="{StaticResource DefaultMargin}">
            
            <!-- 配方基础信息 -->
            <GroupBox Header="基础信息" Style="{StaticResource ModernGroupBoxStyle}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- 配方ID -->
                    <TextBlock Grid.Row="0" Grid.Column="0" Text="配方ID*:" Style="{StaticResource BodyTextStyle}" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="0" Grid.Column="1" 
                             Text="{Binding Recipe.Id, UpdateSourceTrigger=PropertyChanged}"
                             Style="{StaticResource ModernTextBoxStyle}"
                             ToolTip="配方的唯一标识符"/>
                    
                    <!-- 配方类型 -->
                    <TextBlock Grid.Row="0" Grid.Column="2" Text="配方类型*:" Style="{StaticResource BodyTextStyle}" VerticalAlignment="Center"/>
                    <ComboBox Grid.Row="0" Grid.Column="3"
                              SelectedItem="{Binding Recipe.Type}"
                              Style="{StaticResource ModernComboBoxStyle}"
                              ItemsSource="{Binding AvailableRecipeTypes}"
                              ToolTip="选择配方的类型"/>

                    <!-- 配方名称 -->
                    <TextBlock Grid.Row="1" Grid.Column="0" Text="配方名称:" Style="{StaticResource BodyTextStyle}" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="1" Grid.Column="1" 
                             Text="{Binding Recipe.Name, UpdateSourceTrigger=PropertyChanged}"
                             Style="{StaticResource ModernTextBoxStyle}"
                             ToolTip="配方的显示名称"/>
                    
                    <!-- 配方-->
                    <TextBlock Grid.Row="1" Grid.Column="2" Text="配方组" Style="{StaticResource BodyTextStyle}" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="1" Grid.Column="3" 
                             Text="{Binding Recipe.Group, UpdateSourceTrigger=PropertyChanged}"
                             Style="{StaticResource ModernTextBoxStyle}"
                             ToolTip="配方的分组"/>

                    <!-- 解锁条件 -->
                    <TextBlock Grid.Row="2" Grid.Column="0" Text="解锁条件:" Style="{StaticResource BodyTextStyle}" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="2" Grid.Column="1" Grid.ColumnSpan="3"
                             Text="{Binding Recipe.UnlockCondition, UpdateSourceTrigger=PropertyChanged}"
                             Style="{StaticResource ModernTextBoxStyle}"
                             ToolTip="获得此配方所需的条件"/>
                </Grid>
            </GroupBox>

            <!-- 合成网格 -->
            <GroupBox Header="合成配方" Style="{StaticResource ModernGroupBoxStyle}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- 配方类型选择-->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16">
                        <RadioButton Content="工作台配方(3x3)" 
                                     IsChecked="{Binding IsCraftingTableRecipe}"
                                     Style="{StaticResource ModernRadioButtonStyle}"
                                     Margin="0,0,16,0"/>
                        <RadioButton Content="熔炉配方" 
                                     IsChecked="{Binding IsSmeltingRecipe}"
                                     Style="{StaticResource ModernRadioButtonStyle}"
                                     Margin="0,0,16,0"/>
                        <RadioButton Content="切石机配方" 
                                     IsChecked="{Binding IsStonecuttingRecipe}"
                                     Style="{StaticResource ModernRadioButtonStyle}"/>
                    </StackPanel>
                    
                    <!-- 工作台配方界面-->
                    <Grid Grid.Row="1" Visibility="{Binding IsCraftingTableRecipe, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- 合成网格 -->
                        <GroupBox Grid.Column="0" Header="合成材料" Style="{StaticResource ModernGroupBoxStyle}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                
                                <!-- 形状类型-->
                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,8">
                                    <CheckBox Content="有序配方" 
                                              IsChecked="{Binding Recipe.Pattern.IsShaped}"
                                              Style="{StaticResource ModernCheckBoxStyle}"
                                              ToolTip="材料位置固定的配方"/>
                                </StackPanel>
                                
                                <!-- 3x3网格 -->
                                <UniformGrid Grid.Row="1" Rows="3" Columns="3" Width="200" Height="200">
                                    <!-- 第一行-->
                                    <Border Background="{StaticResource SecondaryBackgroundBrush}" 
                                            BorderBrush="{StaticResource BorderBrush}" 
                                            BorderThickness="1" Margin="2">
                                        <TextBox Text="{Binding CraftingGrid[0], UpdateSourceTrigger=PropertyChanged}"
                                                 Style="{StaticResource ModernTextBoxStyle}"
                                                 BorderThickness="0" Background="Transparent"
                                                 HorizontalAlignment="Center" VerticalAlignment="Center"
                                                 ToolTip="拖拽物品到此处或输入物品ID"/>
                                    </Border>
                                    <Border Background="{StaticResource SecondaryBackgroundBrush}" 
                                            BorderBrush="{StaticResource BorderBrush}" 
                                            BorderThickness="1" Margin="2">
                                        <TextBox Text="{Binding CraftingGrid[1], UpdateSourceTrigger=PropertyChanged}"
                                                 Style="{StaticResource ModernTextBoxStyle}"
                                                 BorderThickness="0" Background="Transparent"
                                                 HorizontalAlignment="Center" VerticalAlignment="Center"
                                                 ToolTip="拖拽物品到此处或输入物品ID"/>
                                    </Border>
                                    <Border Background="{StaticResource SecondaryBackgroundBrush}" 
                                            BorderBrush="{StaticResource BorderBrush}" 
                                            BorderThickness="1" Margin="2">
                                        <TextBox Text="{Binding CraftingGrid[2], UpdateSourceTrigger=PropertyChanged}"
                                                 Style="{StaticResource ModernTextBoxStyle}"
                                                 BorderThickness="0" Background="Transparent"
                                                 HorizontalAlignment="Center" VerticalAlignment="Center"
                                                 ToolTip="拖拽物品到此处或输入物品ID"/>
                                    </Border>
                                    
                                    <!-- 第二行-->
                                    <Border Background="{StaticResource SecondaryBackgroundBrush}" 
                                            BorderBrush="{StaticResource BorderBrush}" 
                                            BorderThickness="1" Margin="2">
                                        <TextBox Text="{Binding CraftingGrid[3], UpdateSourceTrigger=PropertyChanged}"
                                                 Style="{StaticResource ModernTextBoxStyle}"
                                                 BorderThickness="0" Background="Transparent"
                                                 HorizontalAlignment="Center" VerticalAlignment="Center"
                                                 ToolTip="拖拽物品到此处或输入物品ID"/>
                                    </Border>
                                    <Border Background="{StaticResource SecondaryBackgroundBrush}" 
                                            BorderBrush="{StaticResource BorderBrush}" 
                                            BorderThickness="1" Margin="2">
                                        <TextBox Text="{Binding CraftingGrid[4], UpdateSourceTrigger=PropertyChanged}"
                                                 Style="{StaticResource ModernTextBoxStyle}"
                                                 BorderThickness="0" Background="Transparent"
                                                 HorizontalAlignment="Center" VerticalAlignment="Center"
                                                 ToolTip="拖拽物品到此处或输入物品ID"/>
                                    </Border>
                                    <Border Background="{StaticResource SecondaryBackgroundBrush}" 
                                            BorderBrush="{StaticResource BorderBrush}" 
                                            BorderThickness="1" Margin="2">
                                        <TextBox Text="{Binding CraftingGrid[5], UpdateSourceTrigger=PropertyChanged}"
                                                 Style="{StaticResource ModernTextBoxStyle}"
                                                 BorderThickness="0" Background="Transparent"
                                                 HorizontalAlignment="Center" VerticalAlignment="Center"
                                                 ToolTip="拖拽物品到此处或输入物品ID"/>
                                    </Border>
                                    
                                    <!-- 第三行-->
                                    <Border Background="{StaticResource SecondaryBackgroundBrush}" 
                                            BorderBrush="{StaticResource BorderBrush}" 
                                            BorderThickness="1" Margin="2">
                                        <TextBox Text="{Binding CraftingGrid[6], UpdateSourceTrigger=PropertyChanged}"
                                                 Style="{StaticResource ModernTextBoxStyle}"
                                                 BorderThickness="0" Background="Transparent"
                                                 HorizontalAlignment="Center" VerticalAlignment="Center"
                                                 ToolTip="拖拽物品到此处或输入物品ID"/>
                                    </Border>
                                    <Border Background="{StaticResource SecondaryBackgroundBrush}" 
                                            BorderBrush="{StaticResource BorderBrush}" 
                                            BorderThickness="1" Margin="2">
                                        <TextBox Text="{Binding CraftingGrid[7], UpdateSourceTrigger=PropertyChanged}"
                                                 Style="{StaticResource ModernTextBoxStyle}"
                                                 BorderThickness="0" Background="Transparent"
                                                 HorizontalAlignment="Center" VerticalAlignment="Center"
                                                 ToolTip="拖拽物品到此处或输入物品ID"/>
                                    </Border>
                                    <Border Background="{StaticResource SecondaryBackgroundBrush}" 
                                            BorderBrush="{StaticResource BorderBrush}" 
                                            BorderThickness="1" Margin="2">
                                        <TextBox Text="{Binding CraftingGrid[8], UpdateSourceTrigger=PropertyChanged}"
                                                 Style="{StaticResource ModernTextBoxStyle}"
                                                 BorderThickness="0" Background="Transparent"
                                                 HorizontalAlignment="Center" VerticalAlignment="Center"
                                                 ToolTip="拖拽物品到此处或输入物品ID"/>
                                    </Border>
                                </UniformGrid>
                            </Grid>
                        </GroupBox>
                        
                        <!-- 箭头 -->
                        <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="16">
                            <Path Data="M 0 0 L 20 10 L 0 20 Z" 
                                  Fill="{StaticResource AccentBrush}" 
                                  Width="20" Height="20"/>
                        </StackPanel>
                        
                        <!-- 结果物品 -->
                        <GroupBox Grid.Column="2" Header="合成结果" Style="{StaticResource ModernGroupBoxStyle}">
                            <StackPanel>
                                <TextBlock Text="物品ID:" Style="{StaticResource BodyTextStyle}"/>
                                <TextBox Text="{Binding Recipe.Result.ItemId, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource ModernTextBoxStyle}"
                                         ToolTip="输出物品的ID"/>
                                
                                <TextBlock Text="数量:" Style="{StaticResource BodyTextStyle}" Margin="0,8,0,0"/>
                                <TextBox Text="{Binding Recipe.Result.Count, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource ModernTextBoxStyle}"
                                         ToolTip="输出物品的数量"/>
                                
                                <!-- 预览区域 -->
                                <Border Background="{StaticResource SecondaryBackgroundBrush}" 
                                        BorderBrush="{StaticResource BorderBrush}" 
                                        BorderThickness="1" 
                                        Width="64" Height="64" 
                                        Margin="0,16,0,0">
                                    <TextBlock Text="预览" 
                                               HorizontalAlignment="Center" 
                                               VerticalAlignment="Center"
                                               Style="{StaticResource SecondaryTextStyle}"/>
                                </Border>
                            </StackPanel>
                        </GroupBox>
                    </Grid>
                    
                    <!-- 熔炉配方界面 -->
                    <Grid Grid.Row="1" Visibility="{Binding IsSmeltingRecipe, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- 输入材料 -->
                        <GroupBox Grid.Column="0" Header="输入材料" Style="{StaticResource ModernGroupBoxStyle}">
                            <StackPanel>
                                <TextBlock Text="物品ID:" Style="{StaticResource BodyTextStyle}"/>
                                <TextBox Text="{Binding SmeltingInput, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource ModernTextBoxStyle}"
                                         ToolTip="输入物品的ID"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <!-- 箭头1 -->
                        <Path Grid.Column="1" Data="M 0 0 L 15 8 L 0 16 Z" 
                              Fill="{StaticResource AccentBrush}" 
                              Width="15" Height="16" 
                              VerticalAlignment="Center" Margin="8"/>
                        
                        <!-- 燃料 -->
                        <GroupBox Grid.Column="2" Header="燃料" Style="{StaticResource ModernGroupBoxStyle}">
                            <StackPanel>
                                <TextBlock Text="燃烧时间(tick):" Style="{StaticResource BodyTextStyle}"/>
                                <TextBox Text="{Binding SmeltingTime, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource ModernTextBoxStyle}"
                                         ToolTip="燃烧所需时间"/>
                                
                                <TextBlock Text="经验" Style="{StaticResource BodyTextStyle}" Margin="0,8,0,0"/>
                                <TextBox Text="{Binding SmeltingExperience, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource ModernTextBoxStyle}"
                                         ToolTip="燃烧完成后获得的经验"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <!-- 箭头2 -->
                        <Path Grid.Column="3" Data="M 0 0 L 15 8 L 0 16 Z" 
                              Fill="{StaticResource AccentBrush}" 
                              Width="15" Height="16" 
                              VerticalAlignment="Center" Margin="8"/>
                        
                        <!-- 输出结果 -->
                        <GroupBox Grid.Column="4" Header="输出结果" Style="{StaticResource ModernGroupBoxStyle}">
                            <StackPanel>
                                <TextBlock Text="物品ID:" Style="{StaticResource BodyTextStyle}"/>
                                <TextBox Text="{Binding Recipe.Result.ItemId, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource ModernTextBoxStyle}"
                                         ToolTip="输出物品的ID"/>
                                
                                <TextBlock Text="数量:" Style="{StaticResource BodyTextStyle}" Margin="0,8,0,0"/>
                                <TextBox Text="{Binding Recipe.Result.Count, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource ModernTextBoxStyle}"
                                         ToolTip="输出物品的数量"/>
                            </StackPanel>
                        </GroupBox>
                    </Grid>
                    
                    <!-- 切石机配方界面-->
                    <Grid Grid.Row="1" Visibility="{Binding IsStonecuttingRecipe, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- 输入材料 -->
                        <GroupBox Grid.Column="0" Header="输入材料" Style="{StaticResource ModernGroupBoxStyle}">
                            <StackPanel>
                                <TextBlock Text="物品ID:" Style="{StaticResource BodyTextStyle}"/>
                                <TextBox Text="{Binding StonecuttingInput, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource ModernTextBoxStyle}"
                                         ToolTip="输入物品的ID"/>
                                
                                <TextBlock Text="数量:" Style="{StaticResource BodyTextStyle}" Margin="0,8,0,0"/>
                                <TextBox Text="{Binding StonecuttingInputCount, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource ModernTextBoxStyle}"
                                         ToolTip="输入物品的数量"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <!-- 箭头 -->
                        <Path Grid.Column="1" Data="M 0 0 L 20 10 L 0 20 Z" 
                              Fill="{StaticResource AccentBrush}" 
                              Width="20" Height="20" 
                              VerticalAlignment="Center" Margin="16"/>
                        
                        <!-- 输出结果 -->
                        <GroupBox Grid.Column="2" Header="输出结果" Style="{StaticResource ModernGroupBoxStyle}">
                            <StackPanel>
                                <TextBlock Text="物品ID:" Style="{StaticResource BodyTextStyle}"/>
                                <TextBox Text="{Binding Recipe.Result.ItemId, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource ModernTextBoxStyle}"
                                         ToolTip="输出物品的ID"/>
                                
                                <TextBlock Text="数量:" Style="{StaticResource BodyTextStyle}" Margin="0,8,0,0"/>
                                <TextBox Text="{Binding Recipe.Result.Count, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource ModernTextBoxStyle}"
                                         ToolTip="输出物品的数量"/>
                            </StackPanel>
                        </GroupBox>
                    </Grid>
                    
                    <!-- 工具按钮 -->
                    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,16,0,0">
                        <Button Content="清空网格" 
                                Style="{StaticResource ModernButtonStyle}"
                                Command="{Binding ClearGridCommand}" Margin="4"/>
                        <Button Content="从模板加载" 
                                Style="{StaticResource ModernButtonStyle}"
                                Command="{Binding LoadTemplateCommand}" Margin="4"/>
                        <Button Content="保存为模板" 
                                Style="{StaticResource ModernButtonStyle}"
                                Command="{Binding SaveTemplateCommand}" Margin="4"/>
                    </StackPanel>
                </Grid>
            </GroupBox>

            <!-- 操作按钮 -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
                <Button Content="重置" 
                        Style="{StaticResource ModernButtonStyle}"
                        Command="{Binding ResetCommand}" Margin="4"/>
                <Button Content="测试配方" 
                        Style="{StaticResource ModernButtonStyle}"
                        Command="{Binding TestRecipeCommand}" Margin="4"/>
                <Button Content="保存" 
                        Style="{StaticResource PrimaryButtonStyle}"
                        Command="{Binding SaveCommand}" Margin="4"/>
            </StackPanel>
        </StackPanel>
    </ScrollViewer>
</UserControl>
